# Requirements for Open Source Document Processor
# Tested with Python 3.10+

# ====== Core Framework ======
fastapi==0.109.0
uvicorn[standard]==0.27.0
pydantic==2.5.3
python-multipart==0.0.6

# ====== PyTorch & Transformers ======
# Install PyTorch separately based on your system:
# With CUDA 12.1: pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121
# With CUDA 11.8: pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
# CPU only: pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu
torch>=2.1.0
torchvision>=0.16.0
torchaudio>=2.1.0

# Transformers and model loading
transformers>=4.46.0
accelerate>=0.26.0
sentencepiece==0.1.99
protobuf==4.25.1
timm>=0.9.12
einops>=0.6.1

# Model quantization (for memory optimization)
bitsandbytes  # Requires CUDA

# ====== Vision & Imaging ======
pdf2image==1.16.3
Pillow==10.2.0
opencv-python==4.9.0.80

# ====== Document Processing ======
PyPDF2==3.0.1
pdfplumber==0.10.3
python-docx==1.1.0

# ====== NLP Libraries ======
spacy==3.7.2
sentence-transformers==2.3.1

# ====== Database ======
sqlalchemy==2.0.25
alembic==1.13.1
asyncpg==0.29.0
psycopg2-binary==2.9.9

# ====== HTTP Client ======
aiohttp==3.9.1
httpx==0.26.0

# ====== Utilities ======
python-dotenv==1.0.0
python-dateutil==2.8.2
pydantic-settings==2.1.0

# ====== Data Processing ======
pandas==2.1.4
numpy==1.26.3

# ====== Monitoring & Logging ======
prometheus-client==0.19.0
sentry-sdk==1.39.2

# ====== Testing ======
pytest==7.4.4
pytest-asyncio==0.23.3
pytest-cov==4.1.0

# ====== Development Tools ======
black==23.12.1
flake8==7.0.0
mypy==1.8.0

# ====== Optional: GPU Monitoring ======
gpustat==1.1.1
nvidia-ml-py3==7.352.0


# ====== INSTALLATION NOTES ======

# 1. Install PyTorch first based on your CUDA version:
#    CUDA 12.1: pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121
#    CUDA 11.8: pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
#    CPU Only:  pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu

# 2. For bitsandbytes (quantization), you need CUDA. Skip if using CPU only.

# 3. Install system dependencies for PDF rendering:
#    Ubuntu/Debian:
#      sudo apt-get update
#      sudo apt-get install poppler-utils
#    
#    macOS:
#      brew install poppler
#    
#    Windows:
#      Download Poppler from: https://github.com/oschwartz10612/poppler-windows/releases/
#      Add the bin folder to PATH.

# 4. Download spaCy models (optional categorization helpers):
#    python -m spacy download en_core_web_sm
#    python -m spacy download ar_core_web_sm

# 5. Verify GPU setup:
#    python -c "import torch; print(f'CUDA: {torch.cuda.is_available()}, Devices: {torch.cuda.device_count()}')"

# ====== MODEL DOWNLOADS ======

# Models will be automatically downloaded from HuggingFace on first use.
# They are cached in ~/.cache/huggingface/

# To pre-download models:
#   python -c "from transformers import AutoModelForCausalLM, AutoProcessor; AutoProcessor.from_pretrained('Qwen/Qwen2.5-VL-7B-Instruct'); AutoModelForCausalLM.from_pretrained('Qwen/Qwen2.5-VL-7B-Instruct')"

# Model sizes (disk space):
#   Qwen2-VL 7B: ~18GB (bf16 weights)
#   Qwen2.5-VL 7B: ~20GB

# ====== LIGHTWEIGHT TESTING (CPU-only) ======
# fastapi==0.109.0
# uvicorn==0.27.0
# transformers>=4.46.0
# PyPDF2==3.0.1
# pdf2image==1.16.3
# Pillow==10.2.0
